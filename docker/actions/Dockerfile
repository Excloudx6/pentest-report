FROM kalilinux/kali


WORKDIR /usr/src/app
RUN echo 'Acquire::https::Verify-Peer "false";\nAcquire::https::Verify-Host "false";\n' > /etc/apt/apt.conf.d/99nocertcheck
RUN cat /etc/apt/apt.conf.d/99nocertcheck
RUN sed -i -e 's/http:/https:/g' /etc/apt/sources.list
RUN apt-get update && apt-get install -y apt-transport-https ca-certificates
RUN rm -f /etc/apt/apt.conf.d/99nocertcheck
RUN apt-get update && apt-get install -y python3 python3-pip nmap curl wget bash vim zsh dirb git nikto nfs-common xvfb
COPY requirements.txt ./
RUN pip3 install --no-cache-dir -r requirements.txt

WORKDIR /usr/src/app/actions
RUN git clone https://github.com/FortyNorthSecurity/EyeWitness.git

WORKDIR /usr/src/app/

## COPY actions/EyeWitness actions/EyeWitness
RUN actions/EyeWitness/Python/setup/setup.sh
# Connection issue fix:
RUN pip3 install selenium==3.14.1

RUN pip3 install bs4 
RUN apt-get install -y xdotool wmctrl x11-utils


RUN sed -i -e 's/#PROMPTS=no/PROMPTS=no/g' /etc/nikto.conf 

COPY . .

RUN ls -l /usr/src/app/actions/
RUN chmod a+rw /usr/src/app/actions/geckodriver.log

RUN groupadd -r pentest && useradd -r -g pentest pentest
RUN mkdir -p /data/actionfiles && chmod 777 /data/actionfiles
USER root

WORKDIR /usr/src/app/actions/

CMD [ "/bin/bash", "./runAllLoop.sh" ]
